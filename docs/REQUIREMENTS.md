# 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
Reframe - Knowledge Network

### 1.2 プロジェクトの目的
知識を繋げて可視化することで、個人の知識管理（セカンドブレイン）を支援するWebアプリケーション。

### 1.3 背景と課題
- 個人が持つ知識が散在し、関連性が見えにくい
- 知識間のつながりを視覚的に理解したい
- 検索した知識を簡単に関連付けたい

### 1.4 解決策
- 知識をノードとして管理
- 知識間の関連性をエッジで表現
- グラフビューで知識ネットワークを可視化
- 検索機能で関連知識を発見

## 2. 機能要件

### 2.1 知識管理機能

#### 2.1.1 知識の作成
- **機能**: 新しい知識を登録する
- **入力項目**:
  - タイトル（1-200文字）
  - コンテンツ（1-10,000文字）
- **バリデーション**:
  - タイトルとコンテンツは必須
  - 文字数制限をチェック
  - 前後の空白を自動削除
- **出力**: 作成された知識のIDとメタデータ

#### 2.1.2 知識の検索
- **機能**: キーワードで知識を検索する
- **検索対象**: タイトルとコンテンツ
- **検索アルゴリズム**:
  - タイトルマッチ: 高スコア（+10点）
  - コンテンツマッチ: 中スコア（+5点）
  - 単語マッチ: タイトル（+3点）、コンテンツ（+1点）
- **出力**: 関連度スコア付きの検索結果リスト（最大10件）

#### 2.1.3 知識の取得
- **機能**: IDで特定の知識を取得する
- **出力**: 知識の詳細情報（タイトル、コンテンツ、作成日時、接続情報）

#### 2.1.4 知識の一覧取得
- **機能**: 全ての知識を取得する
- **用途**: グラフビューの表示
- **出力**: 知識のリスト

### 2.2 知識接続機能

#### 2.2.1 知識の接続
- **機能**: 複数の知識を選択して、新しい知識と接続する
- **フロー**:
  1. 検索結果から複数の知識を選択
  2. 新しい知識を作成（検索クエリをコンテンツとして使用）
  3. 選択した知識と新規知識を双方向で接続
- **接続の性質**: 双方向（無向グラフ）
- **制約**: 同じ知識同士は接続できない

### 2.3 可視化機能

#### 2.3.1 グラフビュー
- **機能**: 知識ネットワークをグラフとして可視化
- **ノード**: 知識（タイトルを表示）
- **エッジ**: 知識間の接続
- **インタラクション**:
  - ノードクリック: 知識の詳細を表示
  - ズーム・パン: グラフの操作
- **表示オプション**:
  - 作成日時の表示/非表示

#### 2.3.2 統計情報
- **機能**: グラフの統計情報を表示
- **表示項目**:
  - ノード数（知識の総数）
  - エッジ数（接続の総数）

### 2.4 UI機能

#### 2.4.1 検索ページ
- **機能**: 知識の検索と接続を行う
- **コンポーネント**:
  - 検索入力欄
  - 検索結果リスト
  - 選択チェックボックス
  - 接続ボタン
  - 詳細表示シート

#### 2.4.2 グラフページ
- **機能**: 知識ネットワークをグラフで表示
- **コンポーネント**:
  - グラフキャンバス
  - 設定パネル
  - 統計情報カード
  - リフレッシュボタン

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **検索応答時間**: 300ms以下（モックデータの場合）
- **グラフレンダリング**: 100ノード以下で60fps維持
- **API応答時間**: 500ms以下

### 3.2 可用性要件
- **稼働率**: 99%以上
- **ダウンタイム**: 月間1時間以下

### 3.3 セキュリティ要件
- **認証**: 現バージョンでは不要（将来の拡張）
- **入力検証**: サーバーサイドで必須
- **XSS対策**: Reactの自動エスケープ
- **CSRF対策**: 将来実装予定

### 3.4 スケーラビリティ要件
- **同時ユーザー数**: 100ユーザーまで対応
- **データ量**: 10,000件の知識まで対応
- **水平スケーリング**: Cloud Runで自動スケーリング

### 3.5 保守性要件
- **コード品質**: TypeScript strictモード
- **テストカバレッジ**: 80%以上（将来実装）
- **ドキュメント**: コードとAPI仕様を文書化

## 4. 技術要件

### 4.1 フロントエンド
- **フレームワーク**: Next.js 16.1.3（App Router）
- **UIライブラリ**: React 19.2.3
- **スタイリング**: Tailwind CSS 4
- **UIコンポーネント**: shadcn/ui
- **グラフライブラリ**: ReactFlow 11.11.4
- **言語**: TypeScript 5

### 4.2 バックエンド
- **フレームワーク**: Hono 4.0.0
- **ランタイム**: Node.js 20
- **言語**: TypeScript 5
- **アーキテクチャ**: クリーンアーキテクチャ

### 4.3 データストレージ
- **現行**: メモリ内モックデータ（開発用）
- **将来**: PostgreSQL 16（本番環境）

### 4.4 インフラストラクチャ
- **コンテナ化**: Docker
- **オーケストレーション**: Docker Compose（開発環境）
- **デプロイ先**: Google Cloud Run
- **データベース**: Cloud SQL（PostgreSQL）

## 5. 制約事項

### 5.1 技術的制約
- モノレポ構成（npm workspaces）
- クリーンアーキテクチャの原則に従う
- TypeScriptの型安全性を維持

### 5.2 ビジネス制約
- 初期バージョンは個人利用を想定
- 認証機能は将来の拡張

### 5.3 法的制約
- 個人情報保護法への準拠（将来の拡張時）

## 6. 将来の拡張機能

### 6.1 認証・認可
- ユーザー認証（Google OAuth、メール/パスワード）
- マルチテナント対応

### 6.2 AI機能
- Vertex AIを使用した知識の要約
- 関連知識の自動提案
- 検索クエリの改善提案

### 6.3 高度な検索
- 全文検索（PostgreSQLの全文検索機能）
- フィルタリング（日付、タグなど）
- ソート機能

### 6.4 エクスポート機能
- 知識のエクスポート（JSON、Markdown）
- グラフの画像エクスポート

### 6.5 コラボレーション機能
- 知識の共有
- コメント機能
- 変更履歴

## 7. 成功基準

### 7.1 機能面
- 全ての機能要件が実装されている
- バリデーションが適切に動作する
- エラーハンドリングが実装されている

### 7.2 パフォーマンス面
- 検索が300ms以内に完了する
- グラフがスムーズにレンダリングされる

### 7.3 ユーザビリティ面
- 直感的なUI/UX
- エラーメッセージが分かりやすい

### 7.4 保守性面
- コードが読みやすい
- テストが書かれている
- ドキュメントが整備されている
